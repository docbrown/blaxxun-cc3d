<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>GvProto Include File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.0.0 on Thu Jan 27 18:49:22 2000 -->
<center>
<a class="qindex"href="index.html">Main Page</a> &nbsp; <a class="qindex"href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex"href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex"href="annotated.html">Compound List</a> &nbsp; <a class="qindex"href="files.html">File List</a> &nbsp; <a class="qindex"href="headers.html">Header Files</a> &nbsp; <a class="qindex"href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex"href="functions.html">Compound Members</a> &nbsp; <a class="qindex"href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>gvproto.h</h1>This is the verbatim text of the gvproto.h include file.<div class="fragment"><pre>/*=============================================================================

This code is licensed under the Web3D-blaxxun Community Source License,
provided in distribution file LICENSE.TXT and available online at
http://www.web3D.org/TaskGroups/x3d/blaxxun/Web3D-blaxxunCommunitySourceAgreement.html
and may only be used for non-commercial use as specified in that license.

THE WEB3D CONSORTIUM AND BLAXXUN DO NOT MAKE AND HEREBY DISCLAIM ANY EXPRESS
OR IMPLIED WARRANTIES RELATING TO THIS CODE, INCLUDING BUT NOT LIMITED TO,
WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE, OR ANY WARRANTIES THAT MIGHT ARISE FROM A COURSE OF DEALING, USAGE
OR TRADE PRACTICE.  THE COMMUNITY SOURCE CODE IS PROVIDED UNDER THIS
AGREEMENT "AS IS," WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT THE COMMUNITY SOURCE CODE ARE
FREE OF DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR
NON-INFRINGING OR IN ANY WAY CONSTITUTE THE COMPLETE PRODUCT MARKETED UNDER
THE NAMES GIVEN SAID CODE.

==============================================================================*/
#ifndef  _GvProto_
#define  _GvProto_

/******************************************************************************
@doc

@module GvProto.h - VRML 2.0 Prototype implementation|

Copyright (c) 1996 - 1999 by Holger Grahn
All rights reserved

Purpose:

Classes:
&lt;c GvProto&gt;
&lt;c GvProtoInstance&gt;

Notes:

Changes:

$Revision: $
$Log: $


Todo :

******************************************************************************/


#include &lt;gvnode.h&gt;

#include &lt;gvsubnode.h&gt;

//#include &lt;gvgroup.h&gt;

#include &lt;gvsfint32.h&gt;

#include &lt;gvsfnode.h&gt;
#include &lt;gvmfnode.h&gt;
#include &lt;gvmfstring.h&gt;
#include &lt;gvsfbool.h&gt;

#include &lt;gvnamespace.h&gt;

#include "www.h"


class GvProtoRoot;

class <a class="code" href="class_gvproto.html">GvProto</a>;
class <a class="code" href="class_gvexternproto.html">GvExternProto</a>;
class <a class="code" href="class_gvprotoinstance.html">GvProtoInstance</a>;

class <a class="code" href="class_gvroute.html">GvRoute</a>;





/* 

  
PROTO prototypename [ eventIn      eventtypename name
                      eventOut     eventtypename name
                      exposedField fieldtypename name defaultValue
                      field        fieldtypename name defaultValue
                      ... ] {
  Scene graph
  (nodes, prototypes, and routes, containing IS statements)
}


Transform {
  set_translation IS set_position
}
processEvents
    eventTranslation
            type sourceName destNode destName



*/

class <a class="code" href="class_gvproto.html">GvProto</a> : public <a class="code" href="class_gvnode.html">GvNode</a> {

    <a class="code" href="class_gvproto.html#c0">GV_NODE_HEADER_UNKNOWN_NODE</a>(<a class="code" href="class_gvproto.html">GvProto</a>);

  public:

    // private children field   
    <a class="code" href="class_gvmfnode.html">GvMFNode</a> children;

     // VRML class-name for this prototype node
    <a class="code" href="class_gvname.html">GvName</a> className;

    // get VRML Type name for node 
        const char *<a class="code" href="class_gvnode.html#a7">GetType</a>();


    void <a class="code" href="class_gvproto.html#a1">setClassName</a>(const char *name);
        const char *<a class="code" href="class_gvproto.html#a2">getClassName</a>() const;

    // interface
    <a class="code" href="class_gvfielddata.html">GvFieldData</a>  protoFieldData; // returned by getFielData

#ifdef _GFULL
        // local Node/PROTO dictionary
        // need to be stored only for Authoring Tool purposes
        // or to allow createVrmlFromString with references to local protos
    <a class="code" href="class_gvnamespace.html">GvNameSpace</a> nameSpace; 
#endif

    
    // all routes internal of this proto, must be instanced for each instance
    <a class="code" href="class_gvmfnode.html">GvMFNode</a> routes;

    // add route to route list
    GvBool <a class="code" href="class_gvnode.html#d17">addRoute</a>(<a class="code" href="class_gvnode.html">GvNode</a> * From,int FromIndex,<a class="code" href="class_gvnode.html">GvNode</a> * To,int ToIndex); 

    // get pointer to field at index 
    // returns NULL, because proto has no fields
    // only a field description
        // fields are creating in a ProtoInstance node 

    <a class="code" href="class_gvfield.html">GvField</a> *<a class="code" href="class_gvnode.html#a20">getField</a>(int index) const;
    
    // get the proto 
    virtual <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvproto.html#a5">getProto</a>() { return (this); }
        
        // get pointer to implementing proto, ovverriden by EXTERNPROTO's
        virtual <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvproto.html#a5">getProto</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state) { return (this); } 


        // create a new instance of proto, copy classname &amp; fieldData
        <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvnode.html#a54">newInstance</a>();

    // create a prototype instance of this prototype
    virtual <a class="code" href="class_gvnode.html">GvNode</a> *<a class="code" href="class_gvnode.html#d13">createInstance</a>();


        // reads name fieldList { graph }
        static <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvnode.html#d5">read</a>(<a class="code" href="class_gvinput.html">GvInput</a> *in);

        // read the event IS protoEvent part
        // event == fieldName

        GvBool <a class="code" href="class_gvproto.html#a9">readEventTranslation</a>(
                        <a class="code" href="class_gvinput.html">GvInput</a> *in, <a class="code" href="class_gvnode.html">GvNode</a> *object,
                        const <a class="code" href="class_gvname.html">GvName</a> &amp;fieldName,
                        int fieldIndex);

        /*
                process IS
                node fieldName IS protoEventName
        */
        GvBool <a class="code" href="class_gvproto.html#a10">DoIs</a>(<a class="code" href="class_gvinput.html">GvInput</a> *in,<a class="code" href="class_gvnode.html">GvNode</a> *node,<a class="code" href="class_gvfield.html">GvField</a> *field, const <a class="code" href="class_gvname.html">GvName</a> &amp;fieldName,<a class="code" href="class_gvname.html">GvName</a> &amp;protoEventName);


        //GvBool readInstance(GvInput *in);


        //int Do(GTraversal &amp;state);    

        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_giotraversal.html">GioTraversal</a> &amp;state);    
        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_gdisplaytreetraversal.html">GDisplayTreeTraversal</a> &amp;state); // implemented in GDisplayTree.cpp
    
    friend class <a class="code" href="class_gvprotoinstance.html">GvProtoInstance</a>;
    friend class <a class="code" href="class_gvexternproto.html">GvExternProto</a>;
};





/*

#VRML V2.0 utf8
PROTO Gold   [] { Material { ... } }
PROTO Silver [] { Material { ... } }
...etc.

A material from this library could be used as follows:

#VRML V2.0 utf8
EXTERNPROTO Gold [] "http://.../materials.wrl#Gold"
...
    Shape {
        appearance Appearance { material Gold {} }
        geometry   ...
    
*/

class <a class="code" href="class_gvexternproto.html">GvExternProto</a> : public <a class="code" href="class_gvproto.html">GvProto</a> 
{
    <a class="code" href="class_gvproto.html#c0">GV_NODE_HEADER_UNKNOWN_NODE</a>(<a class="code" href="class_gvexternproto.html">GvExternProto</a>);

public:

    // url to read proto from
    <a class="code" href="class_gvmfstring.html">GvMFString</a> url; // may contain url#name syntax 

        <a class="code" href="class_gvstring.html">GvString</a> baseUrl; // home url of scene
    <a class="code" href="class_gvnodehandle.html">GvNodeHandle</a> proto; // pointer to prototype if loaded from file

        <a class="code" href="class_gvstring.html">GvString</a>    externProtoName;  // the name of the extern proto

        // create a prototype instance of this prototype, check for native node URN's
        <a class="code" href="class_gvnode.html">GvNode</a>*         <a class="code" href="class_gvnode.html#d13">createInstance</a>();

        <a class="code" href="class_gfileref.html">GFileRef</a>    loader;                     // url loader

        // get absolute home url
        const char *<a class="code" href="class_gvexternproto.html#a1">GetHomeUrl</a>() const;


        // try to load url or get proto definition
        int <a class="code" href="class_gvexternproto.html#a2">Load</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state);


    // get pointer to implementing proto
    <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvproto.html#a5">getProto</a>();

        // get pointer to implementing proto, check for read of externProto
        <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvproto.html#a5">getProto</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state);  
 

        // reads name fieldList [ url ]
        static <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvnode.html#d5">read</a>(<a class="code" href="class_gvinput.html">GvInput</a> *in);

        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_giotraversal.html">GioTraversal</a> &amp;state);    
        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_gdisplaytreetraversal.html">GDisplayTreeTraversal</a> &amp;state); // implemented in GDisplayTree.cpp
};



// this node instances a given proto


class <a class="code" href="class_gvprotoinstance.html">GvProtoInstance</a> : public <a class="code" href="class_gvnode.html">GvNode</a> 
{
    <a class="code" href="class_gvproto.html#c0">GV_NODE_HEADER_UNKNOWN_NODE</a>(<a class="code" href="class_gvprotoinstance.html">GvProtoInstance</a>);

public:

    // private children field   
    <a class="code" href="class_gvmfnode.html">GvMFNode</a> children;
    
    // Eval the "value" node of proto = first children node 
    <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvnode.html#a59">Eval</a>();

    // Eval the "value" node of proto = first children node 
    <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvnode.html#a59">Eval</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state);

    // create an instance of this proto
    <a class="code" href="class_gvproto.html#l0">GvProtoInstance</a>(<a class="code" href="class_gvproto.html">GvProto</a> *proto);
    
    <a class="code" href="class_gvnodehandle.html">GvNodeHandle</a> proto; // pointer to prototype
    
    // list of pointers to fields
    <a class="code" href="class_gvfieldlist.html">GvFieldList</a> fields;
        int *fieldMap;

        // map field index in proto interface
        // to field index in proto instance
        // normally identity, but can occure in EXTERNPROTO
        int <a class="code" href="class_gvprotoinstance.html#a3">MapProtoField</a>(int protoFieldIndex);

    
    // instancing relating helper functions
        GvBool instanced; // is Instance instanced ?

        // delete children
        void <a class="code" href="class_gvprotoinstance.html#a4">deleteAll</a>(); 

        // create a new instance of instance, copy proto field and instance
        <a class="code" href="class_gvnode.html">GvNode</a> * <a class="code" href="class_gvnode.html#a54">newInstance</a>();

    // Instance, create copies/refs of proto scene graph as needed 
    GvBool <a class="code" href="class_gvprotoinstance.html#a6">Instance</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state);

private:
    // create fields according to proto´s interface
    void <a class="code" href="class_gvprotoinstance.html#c1">instanceFields</a>();

        GvBool <a class="code" href="class_gvnode.html#a32">computeCopyOnInstance</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context); 

    // Instance an MFNode field
    void <a class="code" href="class_gvprotoinstance.html#a6">Instance</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context, <a class="code" href="class_gvmfnode.html">GvMFNode</a> *src,<a class="code" href="class_gvmfnode.html">GvMFNode</a> *dest);
    
    // Instance an SFNode field
    void <a class="code" href="class_gvprotoinstance.html#a6">Instance</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context, <a class="code" href="class_gvsfnode.html">GvSFNode</a> *src,<a class="code" href="class_gvsfnode.html">GvSFNode</a> *dest);

    // instance proto node tree
    <a class="code" href="class_gvnode.html">GvNode</a>* <a class="code" href="class_gvprotoinstance.html#c5">InstanceNode</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context, <a class="code" href="class_gvnode.html">GvNode</a> *node);
    
    // instance a single route 
    GvBool <a class="code" href="class_gvprotoinstance.html#c6">InstanceRoute</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context, <a class="code" href="class_gvroute.html">GvRoute</a> *route);

    // Instance an MFNode field containing routes
    void <a class="code" href="class_gvprotoinstance.html#c7">InstanceRoutes</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context,<a class="code" href="class_gvmfnode.html">GvMFNode</a> *src);


public:

        // get VRML class name
    const char *<a class="code" href="class_gvnode.html#a7">GetType</a>() { return(<a class="code" href="class_gvproto.html#a2">getClassName</a>()); }
        const char *<a class="code" href="class_gvproto.html#a2">getClassName</a>() const;


    // get proto this instance is a proto from
    <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvproto.html#a5">getProto</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state) const;

    // get proto this instance is a proto from
    <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvprotoinstance.html#a10">getDefiningProto</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state) const;
    <a class="code" href="class_gvproto.html">GvProto</a> *<a class="code" href="class_gvprotoinstance.html#a10">getDefiningProto</a>() const;

    // get field index of this instance
    <a class="code" href="class_gvfield.html">GvField</a> *<a class="code" href="class_gvnode.html#a20">getField</a>(int index) const;

    //GvRoutes localRoutes; // local routes instanced

    // notification on field change
    virtual int <a class="code" href="class_gvnode.html#a61">OnChanged</a>();


    int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_gtraversal.html">GTraversal</a> &amp;state);          
        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_gpathtraversal.html">GPathTraversal</a> &amp;state);   

        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_giotraversal.html">GioTraversal</a> &amp;state);    
        //int Do(GDisplayTreeTraversal &amp;state); // implemented in GDisplayTree.cpp

        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_goptimizetraversal.html">GOptimizeTraversal</a> &amp;state);      // implemented in GOptimizeTraversal.cpp


};




// helper class for storing route defintion
// for editing i/o etc.
// low level connections can't increment the reference counter of the target nodes,
// circular dependencies would result
// so route keeps also a ref to both nodes of the route 

class <a class="code" href="class_gvroute.html">GvRoute</a> : public <a class="code" href="class_gvnode.html">GvNode</a> {
    <a class="code" href="class_gvroute.html#c0">GV_NODE_HEADER</a>(<a class="code" href="class_gvroute.html">GvRoute</a>);
public:
    // source node for route
        <a class="code" href="class_gvsfnode.html">GvSFNode</a> from;
    <a class="code" href="class_gvsfint32.html">GvSFInt32</a> fromEventIndex;
    
        // destination node for route
    <a class="code" href="class_gvsfnode.html">GvSFNode</a> to;
    <a class="code" href="class_gvsfint32.html">GvSFInt32</a> toEventIndex;

        // the initial value of field toEventIndex in to

        // could be used to restore all fiels with routes to initial values
        <a class="code" href="class_gvfield.html">GvField</a> *toInitialValue;

        void <a class="code" href="class_gvroute.html#a0">SaveInitialValue</a>();
        void <a class="code" href="class_gvroute.html#a1">RestoreInitialValue</a>();

        // is Node To the "to" NODE of this route ?
        GvBool <a class="code" href="class_gvroute.html#a2">isTo</a>(<a class="code" href="class_gvnode.html">GvNode</a> *To) const { return(to.<a class="code" href="class_gvsfnode.html#a4">get</a>() == To); }

        // is Node From the "from" NODE of this route ?
        GvBool <a class="code" href="class_gvroute.html#a3">isFrom</a>(<a class="code" href="class_gvnode.html">GvNode</a> *From) const { return( from.<a class="code" href="class_gvsfnode.html#a4">get</a>() == From); }

    // assign a parse route
    GvBool <a class="code" href="class_gvroute.html#a4">set</a>(<a class="code" href="class_gvnode.html">GvNode</a> * From,int FromIndex,<a class="code" href="class_gvnode.html">GvNode</a> * To,int ToIndex); 

        // set by event names, return FALSE on mismatch
        GvBool <a class="code" href="class_gvroute.html#a4">set</a>(<a class="code" href="class_gvnode.html">GvNode</a> * from, const char* fromEventOut, <a class="code" href="class_gvnode.html">GvNode</a> * to,const char * toEventIn,GvBool verbose = FALSE);

    // matches this route 
    GvBool <a class="code" href="class_gvroute.html#a6">match</a>(<a class="code" href="class_gvnode.html">GvNode</a> * From,int FromIndex,<a class="code" href="class_gvnode.html">GvNode</a> * To,int ToIndex) const; 
        GvBool operator ==(const <a class="code" href="class_gvroute.html">GvRoute</a> &amp;b) const;


    GvBool <a class="code" href="class_gvnode.html#a32">computeCopyOnInstance</a>(<a class="code" href="class_gvcopycontext.html">GvCopyContext</a> &amp;context);

        // is this route in use  ?
    GvBool <a class="code" href="class_gvroute.html#a9">isUnused</a>();

        // get the names of the events from the stored index 
    <a class="code" href="class_gvname.html">GvName</a> <a class="code" href="class_gvroute.html#a10">getFromEventName</a>() const;
    <a class="code" href="class_gvname.html">GvName</a> <a class="code" href="class_gvroute.html#a11">getToEventName</a>() const;

    int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_giotraversal.html">GioTraversal</a> &amp;state);        // in GioTraversal.cpp
        int <a class="code" href="class_gvnode.html#a45">Do</a>(<a class="code" href="class_gdisplaytreetraversal.html">GDisplayTreeTraversal</a> &amp;state); // implemented in GDisplayTree.cpp

};



#endif /* _GVProto_ */

</div></pre><hr><address><small>Generated at Thu Jan 27 18:49:22 2000 for blaxxunContact3D by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=118 height=53></a> 1.0.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-1999</small></address>
</body>
</html>
